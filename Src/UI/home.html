<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta http-equiv="X-UA-Compatible" content="ie=edge">
   <link rel="stylesheet" type="text/css" href="static/main.css">
   <title>Home - EasyLeave</title>
</head>
<style>
   #windowLoad{
      position: fixed;
      top: 0;
      background-color: rgba(255, 255, 255, 0.801);
      font-size: 30px;
      padding: 40vh 0;
      font-weight: 400;
      width: 100%;
      height: 90vh;
      margin: 5vh 0;
      overflow: hidden;
   }

   #navLinks{
      width: 250px;
      margin-top: 10px;
      padding: 10px;
      float: left;
      height: calc(100vh - 100px);
      border-right: 2px solid rgb(96, 0, 126);
   }

   #mainContent{
      margin-left: 280px;
   }

   .heading{
      margin: 15px 0;
   }

   #info{
      border-left: solid rgb(255, 153, 0) 2px;
      margin: 5px;
      padding-left: 3px;
   }

</style> 
<body>

   <header>
      <div id="headerLeft">
         <img src="static/logo.jpg" alt="logo" id="logo">
         <h2>Easy Leave</h2>
      </div>
   </header>

   <div id="container">
      <center id="navLinks">
         <a class="button-style-grey" href="#summary">Summary</a>
         <div x-for-student>
            <a class="button-style-grey" href="#requestLeave">Request Leave</a>
            <a class="button-style-grey" href="#leaveHistory">Leave History</a>
         </div>

         <div x-for-faculty>
            <a class="button-style-grey" href="#pendingApproval">Pending Approval</a>
            <a class="button-style-grey" href="#viewAllRequests">View All Requests</a>
         </div>

      </center>
      <div id="mainContent">
         <div class="targetToShow" id="summary">
            <h2 class="heading">Summary</h2>
         </div>

         <div x-for-student>
            <div class="targetToShow" id="requestLeave">
               <h2 class="heading">Apply for leave</h2>
               <form id="applyForLeaveForm">
                  <input placeholder="Subject" type="text" name="subject" style="width: 300px">
                  <br> <br>
                  <p>Description : </p> <textarea name="desc" style="min-width: 300px; height: 150px;"></textarea>
                  <br> <br>
                  <label>From: </label>
                  <input type="date" name="fromDate">
                  <label>To: </label>
                  <input type="date" name="toDate">
               </form>
               <button class="button-sd" id="applyLeaveBtn" onclick="javascript:applyForLeave()">Apply</button>
            </div>
            <div class="targetToShow" id="leaveHistory"></div>
         </div>

         <div x-for-faculty>
            <div class="targetToShow" id="pendingApproval"></div>
            <div class="targetToShow" id="viewAllRequests"></div>
         </div>

         <div id="info"></div>

      </div>
   </div>
   
</body>
<script src="static/main.js"></script>
<script>
   document.body.insertAdjacentHTML("beforeEnd",`<center id="windowLoad">Loading...</center>`);

   ajax("get","/api/userInfo")
   .then((resp)=>{
      let res = JSON.parse(resp.res);
      let typeToHide = res.type=="faculty"?"student":"faculty";
      document.styleSheets[0].insertRule(`[x-for-${typeToHide}]{ display: none;}`,0);
      $("#windowLoad").innerHTML = "Done.";
      $("#windowLoad").style.animation = "fadeOut linear 2s";
      setTimeout(()=>{
         $("#windowLoad").style.display = "none";
      },2000);
      let summary = {
         Name: res.name,
         "Account Type": res.type==1?"Faculty":"Student"
      };
      if(res.type==2){
         summary["Leaves Approved this month "] = res.numLeaves;
      } else if(res.type==1){
         summary["No of Leaves Processed this month "] = res.numLeavesProcessed;
      }
      for(obj in summary){
         $("#summary").insertAdjacentHTML("beforeEnd",`<strong>${obj} : </strong><span>${summary[obj]}</span><br>`);
      }
   })
   .catch((err)=>{
      $("#windowLoad").innerHTML = `An Error Occured! HTTP ${err.status} <br> <button class="button-sd" onclick="window.location=window.location;">Reload</button>`
   });

   let clearInfo = ()=>{
      $("#info").innerHTML = null;
   }

   let addInfo = (info)=>{
      $("#info").innerHTML = info;
   }

   function applyForLeave(){
      clearInfo();
      let subject = $("#applyForLeaveForm>input[name='subject']").value;
      let desc = $("#applyForLeaveForm>textarea[name='desc']").value;
      let fromDate = $("#applyForLeaveForm>input[name='fromDate']").value;
      let toDate = $("#applyForLeaveForm>input[name='toDate']").value;

      if(!subject || !desc || !fromDate || !toDate){
         return addInfo("All fields are required");
      }

      let btn = buttonClickAnim($("#applyLeaveBtn"));

      ajax('post','/api/s/applyForLeave',`subject=${subject}&desc=${desc}&fromDate=${fromDate}&toDate=${toDate}`)
      .then((res)=>{
         addInfo("Request sucessfully sent");
      })
      .catch((err)=>{
         addInfo(`${err.res}` || `HTTP ${err.status}`);
      })
      .finally(btn.end);

   }

</script>
</html>